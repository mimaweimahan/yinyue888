import{r as _,c as m,o as W,a as k,b as w,n as Y,_ as G,i as L,d as j,e as O,f as t,g as p,t as i,u as l,h as y,j as z,k as J,F as K,w as q,l as T,m as Q,p as Z,q as ee,s as te,v as se,x as ae,y as P,z as U,A as H,B as oe,C as ne,D as ie,E as re}from"./index-D9ZUrC8f.js";const le="/order_files/W11.gif",de=["id","width","height"],ce={__name:"Fireworks",props:{particleCount:{type:[Number,String],default:200},angle:{type:[Number,String],default:80},spread:{type:[Number,String],default:100},startVelocity:{type:[Number,String],default:80},decay:{type:[Number,String],default:.7},ticks:{type:[Number,String],default:1e3},zIndex:{type:[Number,String],default:999999},colors:{type:Array,default:()=>["#5BC0EB","#2176AE","#FDE74C","#9BC53D","#E55934","#FA7921","#FF4242"]},canvasId:{type:String,default:"fireCanvas"},width:{type:[Number,String],default:()=>window.innerWidth},height:{type:[Number,String],default:()=>window.innerHeight},x:{type:[Number,String],default:()=>window.innerWidth/2},y:{type:[Number,String],default:()=>.4*window.innerHeight}},setup(F,{expose:A}){const o=F,e=_(null),r=_(null),h=_(null),v=_(window.devicePixelRatio||1),C=m(()=>Number(o.particleCount)),N=m(()=>Number(o.angle)),I=m(()=>Number(o.spread)),S=m(()=>Number(o.startVelocity)),$=m(()=>Number(o.decay)),R=m(()=>Number(o.ticks)),B=m(()=>Number(o.zIndex)),D=m(()=>Number(o.x)),f=m(()=>Number(o.y)),b=m(()=>Number(o.width)*v.value),n=m(()=>Number(o.height)*v.value),a=g=>parseInt(g,16),M=()=>{if(e.value=document.getElementById(o.canvasId),!e.value){console.error(`Canvas element with id ${o.canvasId} not found`);return}r.value=e.value.getContext("2d"),e.value.width=b.value,e.value.height=n.value,r.value.scale(v.value,v.value),E()},E=()=>{if(!r.value)return;const g=[];for(let u=0;u<C.value;u++){const s=N.value*(Math.PI/180),x=I.value*(Math.PI/180);let c=o.colors[u%o.colors.length];c=c.replace(/[^0-9a-f]/gi,""),c.length<6&&(c=c[0]+c[0]+c[1]+c[1]+c[2]+c[2]);const X={r:a(c.substring(0,2)),g:a(c.substring(2,4)),b:a(c.substring(4,6))};g.push({x:D.value,y:f.value,depth:.5*Math.random()+.6,wobble:10*Math.random(),velocity:.5*S.value+Math.random()*S.value,angle2D:-s+(.5*x-Math.random()*x),tiltAngle:Math.random()*Math.PI,color:X,tick:0,totalTicks:R.value,decay:$.value,random:Math.random()+5,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0})}const d=()=>{if(!r.value)return;r.value.clearRect(0,0,Number(o.width),Number(o.height)),g.filter(s=>{s.x+=Math.cos(s.angle2D)*s.velocity,s.y+=Math.sin(s.angle2D)*s.velocity+5*s.depth,s.wobble+=.1,s.velocity*=s.decay,s.tiltAngle+=.02*Math.random()+.12,s.tiltSin=Math.sin(s.tiltAngle),s.tiltCos=Math.cos(s.tiltAngle),s.random=Math.random()+4,s.wobbleX=s.x+10*Math.cos(s.wobble)*s.depth,s.wobbleY=s.y+10*Math.sin(s.wobble)*s.depth;const x=1-s.tick++/s.totalTicks;return r.value.fillStyle=`rgba(${s.color.r}, ${s.color.g}, ${s.color.b}, ${x})`,r.value.beginPath(),r.value.moveTo(Math.floor(s.x),Math.floor(s.y)),r.value.lineTo(Math.floor(s.wobbleX),Math.floor(s.y+s.random*s.tiltSin)),r.value.lineTo(Math.floor(s.wobbleX+s.random*s.tiltCos),Math.floor(s.wobbleY+s.random*s.tiltSin)),r.value.lineTo(Math.floor(s.x+s.random*s.tiltCos),Math.floor(s.wobbleY)),r.value.closePath(),r.value.fill(),s.tick<s.totalTicks}).length>0&&(h.value=requestAnimationFrame(d))};h.value=requestAnimationFrame(d)},V=()=>{M()};return W(()=>{h.value&&cancelAnimationFrame(h.value)}),A({startFireworks:V}),(g,d)=>(w(),k("canvas",{id:F.canvasId,width:b.value,height:n.value,style:Y({position:"fixed",top:0,left:0,pointerEvents:"none",zIndex:B.value})},null,12,de))}},ue={class:"trade-page"},me={class:"trade-main"},ve={class:"top-nav"},_e={class:"card-title"},he={class:"card-sub"},ge={key:0,class:"music-eq"},pe={class:"card balance-card"},fe={class:"card-title"},be={class:"card-value"},ke={class:"card-sub"},we={class:"success-popup-main"},ye={class:"success-right"},Ce={class:"success-title"},Ne={key:0,class:"success-profit"},Ie={class:"profit-label"},Se={class:"profit-value"},Me={class:"task-popup-main"},xe={class:"popup-header"},Te={class:"popup-title"},Fe={class:"album-section"},Ae={class:"album-cover"},$e={class:"album-info"},Re={class:"album-artist"},Be={class:"album-title"},De={class:"financial-section"},Ee={class:"financial-item"},Ve={class:"financial-label"},qe={class:"financial-value"},Pe={class:"financial-item"},ze={class:"financial-label"},Ue={class:"financial-value"},He={class:"financial-item"},We={class:"financial-label"},Xe={class:"financial-value"},Ye={class:"rating-section"},Ge={class:"rating-item"},Le={class:"rating-label"},je={class:"star-rating"},Oe=["onClick"],Je={class:"rating-item"},Ke={class:"rating-label"},Qe={class:"star-rating"},Ze=["onClick"],et={class:"comment-section"},tt={class:"comment-label"},st=["placeholder"],at={class:"btn-box"},ot={__name:"Trade",setup(F){const A=ee(),{t:o}=L.global,e=j({wallet:{},loading:!1,task:{task_num:0,task_done:0,task_rate:0,task_revenue:"0.0000",credit_tips:"Good credit score"},task_popup_show:!1,success_popup_show:!1,order:{order_id:0,trade_no:"",goods_name:"",goods_pic:"",goods_price:"",goods_num:"",total_price:"",profit:"",created_at:"",is_ready:0,need:0,deposit:"0"},rating:{musician:0,singer:0},comment:""}),r=_(!1),h=_(0),v=_(null),C=n=>typeof requestAnimationFrame=="function"?requestAnimationFrame(n):setTimeout(n,16),N=()=>{v.value&&clearTimeout(v.value),r.value=!1,C(()=>{C(()=>{r.value=!0,v.value=setTimeout(()=>{r.value=!1},1600)})})},I=n=>{if(n==null||n==="")return"0.00";const a=parseFloat(n);return Number.isNaN(a)?"0.00":a.toFixed(2)},S=n=>{const a=parseFloat(n)||0;a>h.value&&N(),h.value=a},$=()=>{A.push("/list")},R=()=>{e.loading||(e.loading=!0,te({message:o("trade.search"),forbidClick:!0,duration:1200}),se().then(n=>{if(e.order=n.data,e.order.need!==void 0&&e.order.need!==null){const a=parseFloat(e.order.need)||0;e.order.deposit=a<0?String(Math.abs(a)):String(a)}else e.order.deposit="0";setTimeout(()=>{e.loading=!1,ae({message:o("trade.trading"),duration:1200})},800),setTimeout(()=>{e.rating.musician=0,e.rating.singer=0,e.comment="",e.task_popup_show=!0,b.value&&e.order.need<0&&b.value.startFireworks()},1400)}).catch(n=>{e.loading=!1,P(n.msg)}))},B=n=>{if(e.rating.musician!==5||e.rating.singer!==5){P(o("trade.rate_required")||"请点满5个星");return}e.loading=!0,re({order_id:n,musician_rating:e.rating.musician,singer_rating:e.rating.singer,comment:e.comment}).then(a=>{e.order=a.data,e.task_popup_show=!1,e.loading=!1,e.rating.musician=0,e.rating.singer=0,e.comment="",e.success_popup_show=!0,N(),f(),setTimeout(()=>{e.success_popup_show=!1},2e3)}).catch(a=>{e.loading=!1,P(a.msg)})},D=()=>{e.rating.musician=0,e.rating.singer=0,e.comment="",f(),e.task_popup_show=!1},f=()=>{Q().then(n=>{e.wallet=n.data}),Z().then(n=>{e.task=n.data,S(n.data?.task_revenue)})},b=_(null);return O(()=>{f();const n=localStorage.getItem("trade_timerId");n&&clearInterval(n);const a=setInterval(()=>{f()},8e3);localStorage.setItem("trade_timerId",a)}),W(()=>{const n=localStorage.getItem("trade_timerId");n&&clearInterval(n)}),(n,a)=>{const M=T("van-popup"),E=T("van-icon"),V=T("van-image"),g=T("van-button");return w(),k("div",ue,[a[10]||(a[10]=t("div",{class:"trade-bg-blur"},null,-1)),a[11]||(a[11]=t("div",{class:"trade-bg-mask"},null,-1)),t("div",me,[t("div",ve,[a[5]||(a[5]=t("div",{class:"nav-left"},null,-1)),t("button",{class:"records-3d-btn",onClick:$},i(l(o)("trade.records")||"订单记录"),1)]),t("div",{class:y(["card earnings-card",{"income-beat":r.value}])},[t("div",_e,i(l(o)("trade.today_income")||"今日收益(USD)"),1),t("div",{class:y(["card-value",{"income-beat":r.value}])},i(I(e.task?.task_revenue)),3),t("div",he,i(l(o)("trade.auto_update")||"每日收益自动更新"),1),r.value?(w(),k("div",ge,[...a[6]||(a[6]=[J('<span class="bar b1" data-v-128124d6></span><span class="bar b2" data-v-128124d6></span><span class="bar b3" data-v-128124d6></span><span class="bar b4" data-v-128124d6></span><span class="bar b5" data-v-128124d6></span>',5)])])):z("",!0)],2),t("div",pe,[t("div",fe,i(l(o)("trade.balance")||"账户余额(USD)"),1),t("div",be,i(I(e.wallet?.balance??e.wallet?.total_balance)),1),t("div",ke,i(l(o)("trade.balance_tip")||"每个应用的利润将添加到总资产余额中"),1)]),t("div",{class:y(["main-btn",{disabled:e.loading}]),onClick:R},i(l(o)("trade.start")||"初始")+" ("+i(e.task?.task_done||0)+"/"+i(e.task?.task_num||0)+") ",3),a[8]||(a[8]=t("div",{class:"bottom-eq"},[t("img",{src:le,alt:"eq"})],-1)),a[9]||(a[9]=t("div",{class:"ft-h"},null,-1)),p(K,{active:"trade"}),p(M,{show:e.success_popup_show,"onUpdate:show":a[0]||(a[0]=d=>e.success_popup_show=d),"close-on-click-overlay":!0,"close-on-popstate":!1,"lock-scroll":"",class:"success-popup"},{default:q(()=>[t("div",we,[a[7]||(a[7]=t("div",{class:"success-left"},[t("div",{class:"success-icon"},[t("div",{class:"success-checkmark"},[t("div",{class:"checkmark-circle"}),t("div",{class:"checkmark-stem"}),t("div",{class:"checkmark-kick"})])])],-1)),t("div",ye,[t("div",Ce,i(l(o)("trade.success")||"交易成功"),1),e.order?.profit?(w(),k("div",Ne,[t("span",Ie,i(l(o)("trade.list.profit")||"预计收益")+"：",1),t("span",Se,"$"+i(e.order.profit),1)])):z("",!0)])])]),_:1},8,["show"]),p(M,{show:e.task_popup_show,"onUpdate:show":a[4]||(a[4]=d=>e.task_popup_show=d),"close-on-click-overlay":!1,"close-on-popstate":!1,"lock-scroll":"",class:"task-popup"},{default:q(()=>[t("div",Me,[t("div",xe,[t("div",Te,i(l(o)("trade.purchase_album")||"购买专辑:"),1),p(E,{name:"cross",class:"close-icon",onClick:a[1]||(a[1]=d=>D())})]),t("div",Fe,[t("div",Ae,[p(V,{src:e.order?.goods_pic,fit:"cover"},null,8,["src"])]),t("div",$e,[t("div",Re,i(l(o)("trade.album_artist")||"SEGRETO"),1),t("div",Be,i(e.order?.goods_name||"Give Me A Chance"),1)])]),t("div",De,[t("div",Ee,[t("div",Ve,i(l(o)("trade.list.total_amount")||"订单金额"),1),t("div",qe,"$"+i(e.order?.total_price||"0.00"),1)]),t("div",Pe,[t("div",ze,i(l(o)("trade.deposit")||"存款"),1),t("div",Ue,"$"+i(e.order?.deposit||"0"),1)]),t("div",He,[t("div",We,i(l(o)("trade.list.profit")||"订单利润"),1),t("div",Xe,"$"+i(e.order?.profit||"0.00"),1)])]),t("div",Ye,[t("div",Ge,[t("div",Le,i(l(o)("trade.musician")||"音乐家"),1),t("div",je,[(w(),k(U,null,H(5,(d,u)=>t("span",{key:u,class:y(["star",{active:u<e.rating.musician}]),onClick:s=>e.rating.musician=u+1}," ★ ",10,Oe)),64))])]),t("div",Je,[t("div",Ke,i(l(o)("trade.singer")||"歌手"),1),t("div",Qe,[(w(),k(U,null,H(5,(d,u)=>t("span",{key:u,class:y(["star",{active:u<e.rating.singer}]),onClick:s=>e.rating.singer=u+1}," ★ ",10,Ze)),64))])])]),t("div",et,[t("div",tt,i(l(o)("trade.song_review")||"歌曲评论"),1),oe(t("textarea",{"onUpdate:modelValue":a[2]||(a[2]=d=>e.comment=d),class:"comment-input",placeholder:l(o)("trade.comment_placeholder")||"Type here",rows:"2"},null,8,st),[[ne,e.comment]])]),t("div",at,[p(g,{class:"submit-btn",type:"primary",loading:e.loading,onClick:a[3]||(a[3]=d=>B(e.order?.order_id))},{default:q(()=>[ie(i(l(o)("trade.submit")||"提交"),1)]),_:1},8,["loading"])])])]),_:1},8,["show"]),p(ce,{ref_key:"fireRef",ref:b},null,512)])])}}},it=G(ot,[["__scopeId","data-v-128124d6"]]);export{it as default};
