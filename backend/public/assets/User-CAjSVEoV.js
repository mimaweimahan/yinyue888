import{_ as K,H as W,i as q,I as E,d as M,r as O,c as j,e as z,o as H,a as f,f as t,g as c,u,J,D as p,t as n,l as w,z as R,A as Y,w as _,F as G,K as P,L as Q,y as v,M as b,q as X,p as Z,b as g,j as ee,N as se,O as te}from"./index-D9ZUrC8f.js";const oe={class:"user-wrapper"},ae={class:"user-wrapper-main"},ne={class:"user-card"},ie={class:"user-info"},re=["src"],ce={class:"info-text"},de={class:"account"},le={class:"sub"},ue={class:"stat-list"},_e={class:"stat-item"},me={class:"stat-label"},pe={class:"stat-item"},he={class:"stat-label"},fe={class:"stat-value"},we={class:"stat-item"},ve={class:"stat-label"},ge={class:"stat-value"},Ie={class:"menu-card"},ye=["onClick"],be={class:"left"},ke=["src"],Ce={class:"ft-button"},Ue={class:"withdraw-popup-main"},Se={class:"tip"},Ae={class:"input-box"},xe={class:"btn-box"},$e={class:"notice-popup-main"},Ne={class:"notice-header"},Ve={class:"notice-title"},Te={class:"notice-content"},Fe={class:"notice-footer"},Le={__name:"User",setup(Be){const{websocket:C,isConnected:U}=W();U||C.init();const{t:a}=q.global,d=E(),h=X(),s=M({loading:!1,userInfo:d.userInfo,withdraw_show:!1,address_withdraw:"",notice:{title:"",note:"",uid:""},notice_show:!1}),k=O(!1);d.userInfo?.address_withdraw&&(s.address_withdraw=d.userInfo.address_withdraw);const S=j(()=>[{name:a("mine.withdraw"),url:"/withdraw",icon:"/images/mine/records.png"},{name:a("mine.recharge"),url:"/recharge",icon:"/images/mine/pass.png"},{name:a("mine.records"),url:"/records",icon:"/images/mine/records.png"},{name:a("tabBar.team"),url:"/team",icon:"/images/mine/team.png"},{name:a("mine.withdraw_address")||a("mine.withdraw"),url:"/withdraw",icon:"/images/mine/security.png"},{name:a("mine.kyc")||"KYC",url:"/authenticator",icon:"/images/mine/security.png"},{name:a("mine.safepass"),url:"/securitypin",icon:"/images/mine/security.png"},{name:a("lang.lang_switch"),url:"/lang",icon:"/images/dq.png"},{name:a("mine.customer_service")||"客服",action:"kf",icon:"/images/server.png"}]),A=()=>{d.logout(),h.push({path:"/login"})},x=e=>{h.push({path:e.url})},$=e=>{if(e.action==="kf"){h.push("/customer-service");return}if(e.url==="/withdraw"){V();return}e.url&&x(e)},N=async e=>{if(!e){v("No content to copy");return}try{await navigator.clipboard.writeText(e),b("Copy success")}catch{const r=document.createElement("textarea");r.value=e,r.setAttribute("readonly",""),r.style.position="absolute",r.style.left="-9999px",document.body.appendChild(r),r.select();const l=document.execCommand("copy");document.body.removeChild(r),l?b("Copy success"):v("Copy failed")}},V=()=>(s.userInfo?.address_withdraw?h.push({path:"/withdraw"}):s.withdraw_show=!0,!1),T=()=>{if(!s.address_withdraw)return v(a("mine.enter_address")),!1;se({address:s.address_withdraw}).then(e=>{b(e.msg),I(),s.withdraw_show=!1}).catch(e=>{v(e.msg)})},I=()=>{P().then(e=>{const o={...s.userInfo,...e.data};!o.credit_score&&s.userInfo?.credit_score&&(o.credit_score=s.userInfo.credit_score),s.userInfo=o,d.updateUserInfo(o),k.value||F()}).catch(e=>{console.log(e)})},F=async()=>{try{const e=await Z(),o=e?.data?.credit_score,r=e?.data?.credit_usdt,l=e?.data?.credit_tips,y=e?.data?.task_revenue,m={...s.userInfo,credit_score:o,credit_usdt:r,credit_tips:l,task_revenue:y};s.userInfo=m,d.updateUserInfo(m),k.value=!0}catch(e){console.log(e)}},L=()=>{Q().then(e=>{e.data&&e.data.title&&e.data.note&&(s.notice=e.data,s.notice_show=!0)}).catch(e=>{console.log(e)})},B=()=>{s.notice.uid&&te({uid:s.notice.uid}).catch(e=>{console.log(e)}),s.notice_show=!1,s.notice={title:"",note:"",uid:""}};return z(()=>{d.isAuthenticated||d.logout(),I(),L();const e=localStorage.getItem("timerId");clearInterval(e);const o=setInterval(function(){I()},5e3);localStorage.setItem("timerId",o)}),H(()=>{const e=localStorage.getItem("timerId");clearInterval(e)}),(e,o)=>{const r=w("van-icon"),l=w("van-button"),y=w("van-field"),m=w("van-popup");return g(),f("div",oe,[o[9]||(o[9]=t("div",{class:"user-bg-blur"},null,-1)),o[10]||(o[10]=t("div",{class:"user-bg-mask"},null,-1)),t("div",ae,[t("div",ne,[t("div",ie,[t("img",{src:s.userInfo?.avatar??u(J),alt:"avatar"},null,8,re),t("div",ce,[t("div",de,[p(n(s.userInfo?.tel||s.userInfo?.email||u(a)("login.mobile"))+" ",1),c(r,{name:"shield-o",class:"verified"})]),t("div",le,n(u(a)("home.credit")||"信用评分")+"："+n(s.userInfo?.credit_score??"--"),1)])]),t("div",ue,[t("div",_e,[t("div",me,n(e.$t("login.invite")),1),t("div",{class:"stat-value copyable",onClick:o[0]||(o[0]=i=>N(s.userInfo?.invite))},n(s.userInfo?.invite||"--"),1)]),t("div",pe,[t("div",he,n(e.$t("mine.today_profit")||"本轮收益 (USD)"),1),t("div",fe,n(s.userInfo?.task_revenue??s.userInfo?.today_profit??"0"),1)]),t("div",we,[t("div",ve,n(e.$t("mine.available"))+" (USD)",1),t("div",ge,n(s.userInfo?.balance||"0"),1)])])]),t("div",Ie,[(g(!0),f(R,null,Y(S.value,(i,D)=>(g(),f("div",{class:"menu-item",key:D,onClick:De=>$(i)},[t("div",be,[i.icon?(g(),f("img",{key:0,src:i.icon,class:"menu-icon"},null,8,ke)):ee("",!0),t("span",null,n(i.name),1)]),o[7]||(o[7]=t("span",{class:"arrow"},"›",-1))],8,ye))),128))]),t("div",Ce,[c(l,{type:"black",class:"logout",onClick:o[1]||(o[1]=i=>A())},{default:_(()=>[p(n(e.$t("mine.logout")),1)]),_:1})])]),c(m,{show:s.withdraw_show,"onUpdate:show":o[5]||(o[5]=i=>s.withdraw_show=i),class:"withdraw-popup"},{default:_(()=>[t("div",Ue,[t("div",Se,n(u(a)("mine.set_address")),1),t("div",Ae,[c(y,{class:"address_withdraw",modelValue:s.address_withdraw,"onUpdate:modelValue":o[2]||(o[2]=i=>s.address_withdraw=i),placeholder:u(a)("mine.enter_address")},null,8,["modelValue","placeholder"])]),t("div",xe,[c(l,{class:"item",type:"theme",loading:s.loading,onClick:o[3]||(o[3]=i=>T())},{default:_(()=>[p(n(u(a)("mine.set")),1)]),_:1},8,["loading"]),c(l,{class:"item btn2",type:"red",onClick:o[4]||(o[4]=i=>s.withdraw_show=!1)},{default:_(()=>[p(n(u(a)("mine.cancel")),1)]),_:1})])])]),_:1},8,["show"]),c(m,{show:s.notice_show,"onUpdate:show":o[6]||(o[6]=i=>s.notice_show=i),"close-on-click-overlay":!1,"close-on-popstate":!1,"lock-scroll":"",class:"notice-popup"},{default:_(()=>[t("div",$e,[t("div",Ne,[t("div",Ve,n(s.notice.title||""),1)]),t("div",Te,n(s.notice.note||""),1),t("div",Fe,[c(l,{class:"notice-ok-btn",type:"primary",onClick:B},{default:_(()=>[...o[8]||(o[8]=[p(" OK ",-1)])]),_:1})])])]),_:1},8,["show"]),c(G,{active:"user"})])}}},We=K(Le,[["__scopeId","data-v-7627aada"]]);export{We as default};
