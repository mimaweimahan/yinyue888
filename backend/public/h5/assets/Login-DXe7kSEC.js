import{l as o,G as a,P as e,A as l,M as t,R as n,z as s,S as i,T as c}from"./index-Sm2rxOHe.js";import{r as p,v as r,k as u,m as d,z as g,Q as m,q as _,l as f,O as v,f as w,L as h,P as y,_ as k,S as b}from"./vue-vendor-C3e-Kb3Z.js";import{B as x,a as V,b as C,C as U,T as j}from"./TopIcons-C2xlCYKa.js";import"./index-D7DSLlth.js";import"./use-route-BAW5XLj3.js";import"./index-B-_aqH77.js";import"./index-7etSgMpZ.js";const $={class:"switch-type"},A={key:0,class:"uni-input-wrapper"},L={class:"label-text"},S={key:1,class:"uni-input-wrapper"},I={class:"label-text"},P={class:"uni-input-wrapper"},R={class:"label-text"},q={class:"form_btn"},D={class:"regLink"},T={class:"forgot-password-popup"},z={class:"popup-header"},O={class:"popup-content"},W={class:"popup-tip"},B={class:"uni-input-wrapper"},G={class:"label-text"},M={class:"popup-footer"},Q={__name:"Login",setup(Q){const{t:E}=o.global,F=p("AC +1"),H=p(!1),J=p(!1),K=a(),N=m(),X=r({ac_type:1,account:"",password:"",country_code:"1"}),Y=p(!1),Z=p(""),oo=p(!1),ao=o=>{X.ac_type=o},eo=()=>{H.value=!0},lo=o=>{o&&(o.preventDefault(),o.stopPropagation()),Y.value=!0,Z.value=""},to=async()=>{const o=Z.value?.trim();if(!o)return void s(E("login.account_tip")||"请输入手机号或邮箱");const a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o),e=/^[\d+\-\s()]+$/.test(o.replace(/\s/g,""));if(a||e){oo.value=!0;try{const e={};a?e.email=o:e.phone=o.replace(/\s/g,"");const l=await i(e),t=l?.data||{},n=t.agent_url||t.broker_url||t.salesman_url||t.agent_kf_url,s=t.proxy_url||t.agency_url||t.proxy_kf_url;let c=n||s||t.url||t.kf_url||t.customer_service||t.top_kf;c?c.startsWith("/")&&(c=window.location.origin+c):c=window.location.origin+"/index/user/kfindex",Y.value=!1,N.push({path:"/forgot-password-kf",query:{account:o,type:a?"email":"phone"}}).catch(e=>{window.location.href=`/forgot-password-kf?account=${encodeURIComponent(o)}&type=${a?"email":"phone"}`})}catch(l){Y.value=!1,N.push({path:"/forgot-password-kf",query:{account:o,type:a?"email":"phone"}}).catch(e=>{window.location.href=`/forgot-password-kf?account=${encodeURIComponent(o)}&type=${a?"email":"phone"}`})}finally{oo.value=!1}}else s(E("login.account_format_error")||"请输入正确的手机号或邮箱格式")},no=async()=>{try{const o=await appDownloadApi({});if(1===o?.code&&Array.isArray(o?.data)&&o.data.length>0){const a=o.data[0]?.url;a?c(a):s(E("common.get_download_link_failed")||"获取下载链接失败")}else s(o?.msg||E("common.get_download_link_failed")||"获取下载链接失败")}catch(o){s(o?.msg||E("common.get_download_link_failed")||"获取下载链接失败")}};function so(o){F.value=o.abbreviation+" +"+o.code,X.country_code=o.code}function io(){return X.account||1!=X.ac_type?X.account||2!=X.ac_type?X.password?(J.value=!0,void n(X).then(o=>{t(o.msg),K.login(o.data.userInfo,o.data.token),J.value=!1,N.push("/")}).catch(o=>{J.value=!1,s(o.msg)})):(t(E("login.password_tip")),!1):(t(E("login.email_tip")),!1):(t(E("login.mobile_tip")),!1)}return(o,a)=>{const t=_("RouterLink"),n=l,s=e;return f(),u(x,{title:g(E)("login.logintext")},{top:d(()=>[w(j,{class:"top-icons-lg",onServer:a[0]||(a[0]=o=>g(N).push("/customer-service")),onLang:a[1]||(a[1]=o=>g(N).push("/lang")),onDownload:no})]),default:d(()=>[v("div",$,[1===X.ac_type?(f(),h("span",{key:0,onClick:a[2]||(a[2]=o=>ao(2))},y(g(E)("login.loginemail")),1)):(f(),h("span",{key:1,onClick:a[3]||(a[3]=o=>ao(1))},y(g(E)("login.loginmobile")),1))]),v("form",{class:"login-form",autocomplete:"off",onSubmit:k(io,["prevent"])},[1===X.ac_type?(f(),h("div",A,[v("label",L,y(g(E)("login.mobile")),1),w(V,{modelValue:X.account,"onUpdate:modelValue":a[4]||(a[4]=o=>X.account=o),placeholder:g(E)("login.mobile_tip"),prefix:F.value,"prefix-clickable":!0,onPrefixClick:eo},null,8,["modelValue","placeholder","prefix"])])):(f(),h("div",S,[v("label",I,y(g(E)("login.email")),1),w(V,{modelValue:X.account,"onUpdate:modelValue":a[5]||(a[5]=o=>X.account=o),placeholder:g(E)("login.email_tip")},null,8,["modelValue","placeholder"])])),v("div",P,[v("label",R,[v("span",null,y(g(E)("login.password")),1),v("span",{class:"tip",onClick:k(lo,["stop"])},y(g(E)("login.forgot")),1)]),w(V,{modelValue:X.password,"onUpdate:modelValue":a[6]||(a[6]=o=>X.password=o),type:"password",placeholder:g(E)("login.password_tip"),"toggle-password":!0},null,8,["modelValue","placeholder"])]),v("div",q,[w(C,{class:"login-3d-btn","native-type":"submit",loading:J.value},{default:d(()=>[b(y(g(E)("login.logintext")),1)]),_:1},8,["loading"])]),v("div",D,[b(y(g(E)("login.donthave"))+" ",1),w(t,{to:"/signup"},{default:d(()=>[b(y(g(E)("login.signuptext")),1)]),_:1})])],32),w(U,{show:H.value,"onUpdate:show":a[7]||(a[7]=o=>H.value=o),code:X.country_code,onOnCountrySelect:so},null,8,["show","code"]),w(s,{show:Y.value,"onUpdate:show":a[10]||(a[10]=o=>Y.value=o),position:"center",round:"",style:{width:"90%",maxWidth:"400px",padding:"24px"},"close-on-click-overlay":!0},{default:d(()=>[v("div",T,[v("div",z,[v("h3",null,y(g(E)("login.forgot_password_title")||"忘记密码"),1),w(n,{name:"cross",class:"close-icon",onClick:a[8]||(a[8]=o=>Y.value=!1)})]),v("div",O,[v("p",W,y(g(E)("login.forgot_password_tip")||"请输入您的账号（手机号或邮箱），我们将为您提供专属客服链接"),1),v("div",B,[v("label",G,y(g(E)("login.account")||"账号"),1),w(V,{modelValue:Z.value,"onUpdate:modelValue":a[9]||(a[9]=o=>Z.value=o),placeholder:g(E)("login.account_tip")||"请输入手机号或邮箱"},null,8,["modelValue","placeholder"])])]),v("div",M,[w(C,{class:"submit-btn",loading:oo.value,onClick:to},{default:d(()=>[b(y(g(E)("login.get_customer_service")||"获取客服链接"),1)]),_:1},8,["loading"])])])]),_:1},8,["show"])]),_:1},8,["title"])}}};export{Q as default};
