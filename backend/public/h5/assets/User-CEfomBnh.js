import{_ as e,E as s,l as a,G as t,H as i,A as o,q as n,P as r,F as c,J as d,K as l,z as u,M as m,s as p,N as w,O as h}from"./index-Sm2rxOHe.js";import"./index-D7DSLlth.js";import{F as v}from"./index-B-_aqH77.js";import{B as _}from"./index-7etSgMpZ.js";import{v as f,r as g,c as I,o as b,b as y,L as k,O as C,f as x,z as U,S as j,P as S,F as $,M as A,m as F,Q as O,l as V,R as q}from"./vue-vendor-C3e-Kb3Z.js";import{u as z}from"./useTimer-Cu50OUA5.js";import"./use-route-BAW5XLj3.js";const B={class:"user-wrapper"},D={class:"user-wrapper-main"},E={class:"user-card"},K={class:"user-info"},M=["src"],N={class:"info-text"},P={class:"account"},T={class:"sub"},G={class:"stat-list"},H={class:"stat-item"},J={class:"stat-label"},L={class:"stat-item"},Q={class:"stat-label"},R={class:"stat-value"},W={class:"stat-item"},X={class:"stat-label"},Y={class:"stat-value"},Z={class:"menu-card"},ee=["onClick"],se={class:"left"},ae=["src"],te={class:"ft-button"},ie={class:"withdraw-popup-main"},oe={class:"tip"},ne={class:"input-box"},re={class:"btn-box"},ce={class:"notice-popup-main"},de={class:"notice-header"},le={class:"notice-title"},ue={class:"notice-content"},me={class:"notice-footer"},pe=e({__name:"User",setup(e){const{websocket:pe,isConnected:we}=s();we||pe.init();const{t:he}=a.global,ve=t(),_e=O(),fe=f({loading:!1,userInfo:ve.userInfo,withdraw_show:!1,address_withdraw:"",notice:{title:"",note:"",uid:""},notice_show:!1}),ge=g(!1),Ie=I(()=>{const e=fe.userInfo;if(!e)return he("login.mobile")||"--";const s=e.tel||e.phone||e.mobile||(e.account&&!e.account.includes("@")?e.account:null);return s||(e.email?e.email:e.username||e.account||he("login.mobile")||"--")});ve.userInfo?.address_withdraw&&(fe.address_withdraw=ve.userInfo.address_withdraw);const be=I(()=>[{name:he("mine.withdraw"),url:"/withdraw",icon:"/images/mine/records.png"},{name:he("mine.recharge"),url:"/recharge",icon:"/images/mine/pass.png"},{name:he("mine.records"),url:"/records",icon:"/images/mine/records.png"},{name:he("tabBar.team"),url:"/team",icon:"/images/mine/team.png"},{name:he("mine.withdraw_address")||he("mine.withdraw"),url:"/withdraw",icon:"/images/mine/security.png"},{name:he("mine.safepass"),url:"/securitypin",icon:"/images/mine/security.png"},{name:he("lang.lang_switch"),url:"/lang",icon:"/images/dq.png"},{name:he("mine.customer_service")||"客服",action:"kf",icon:"/images/server.png"}]);z(()=>{Ce()},5e3,"timerId");const ye=e=>{"kf"!==e.action?"/withdraw"!==e.url?e.url&&(e=>{_e.push({path:e.url})})(e):ke():_e.push("/customer-service")},ke=()=>(fe.userInfo?.address_withdraw?_e.push({path:"/withdraw"}):fe.withdraw_show=!0,!1),Ce=()=>{d().then(e=>{const s={...fe.userInfo,...e.data};!s.credit_score&&fe.userInfo?.credit_score&&(s.credit_score=fe.userInfo.credit_score),fe.userInfo=s,ve.updateUserInfo(s),ge.value||xe()}).catch(e=>{})},xe=async()=>{try{const e=await p(),s=e?.data?.credit_score,a=e?.data?.credit_usdt,t=e?.data?.credit_tips,i=e?.data?.task_revenue,o={...fe.userInfo,credit_score:s,credit_usdt:a,credit_tips:t,task_revenue:i};fe.userInfo=o,ve.updateUserInfo(o),ge.value=!0}catch(e){}},Ue=()=>{fe.notice.uid&&h({uid:fe.notice.uid}).catch(e=>{}),fe.notice_show=!1,fe.notice={title:"",note:"",uid:""}};return b(()=>{ve.isAuthenticated||ve.logout(),Ce(),l().then(e=>{e.data&&e.data.title&&e.data.note&&(fe.notice=e.data,fe.notice_show=!0)}).catch(e=>{});const e=localStorage.getItem("timerId");clearInterval(e);const s=setInterval(function(){Ce()},5e3);localStorage.setItem("timerId",s)}),y(()=>{const e=localStorage.getItem("timerId");clearInterval(e)}),(e,s)=>{const a=o,t=_,d=v,l=r;return V(),k("div",B,[s[9]||(s[9]=C("div",{class:"user-bg-blur"},null,-1)),s[10]||(s[10]=C("div",{class:"user-bg-mask"},null,-1)),C("div",D,[C("div",E,[C("div",K,[C("img",{src:fe.userInfo?.avatar??U(i),alt:"avatar"},null,8,M),C("div",N,[C("div",P,[j(S(Ie.value)+" ",1),x(a,{name:"shield-o",class:"verified"})]),C("div",T,S(U(he)("home.credit")||"信用评分")+"："+S(fe.userInfo?.credit_score??"--"),1)])]),C("div",G,[C("div",H,[C("div",J,S(e.$t("login.invite")),1),C("div",{class:"stat-value copyable",onClick:s[0]||(s[0]=e=>(async e=>{if(e)try{await navigator.clipboard.writeText(e),m("Copy success")}catch(s){const a=document.createElement("textarea");a.value=e,a.setAttribute("readonly",""),a.style.position="absolute",a.style.left="-9999px",document.body.appendChild(a),a.select();const t=document.execCommand("copy");document.body.removeChild(a),t?m("Copy success"):u("Copy failed")}else u("No content to copy")})(fe.userInfo?.invite))},S(fe.userInfo?.invite||"--"),1)]),C("div",L,[C("div",Q,S(e.$t("mine.today_profit")||"本轮收益(USD)"),1),C("div",R,S(U(n)(fe.userInfo?.task_revenue??fe.userInfo?.today_profit??0)),1)]),C("div",W,[C("div",X,S(e.$t("mine.available"))+" (USD)",1),C("div",Y,S(U(n)(fe.userInfo?.balance??0)),1)])])]),C("div",Z,[(V(!0),k($,null,A(be.value,(e,a)=>(V(),k("div",{class:"menu-item",key:a,onClick:s=>ye(e)},[C("div",se,[e.icon?(V(),k("img",{key:0,src:e.icon,class:"menu-icon"},null,8,ae)):q("",!0),C("span",null,S(e.name),1)]),s[7]||(s[7]=C("span",{class:"arrow"},"›",-1))],8,ee))),128))]),C("div",te,[x(t,{type:"black",class:"logout",onClick:s[1]||(s[1]=e=>(ve.logout(),void _e.push({path:"/login"})))},{default:F(()=>[j(S(e.$t("mine.logout")),1)]),_:1})])]),x(l,{show:fe.withdraw_show,"onUpdate:show":s[5]||(s[5]=e=>fe.withdraw_show=e),class:"withdraw-popup"},{default:F(()=>[C("div",ie,[C("div",oe,S(U(he)("mine.set_address")),1),C("div",ne,[x(d,{class:"address_withdraw",modelValue:fe.address_withdraw,"onUpdate:modelValue":s[2]||(s[2]=e=>fe.address_withdraw=e),placeholder:U(he)("mine.enter_address")},null,8,["modelValue","placeholder"])]),C("div",re,[x(t,{class:"item",type:"theme",loading:fe.loading,onClick:s[3]||(s[3]=e=>(()=>{if(!fe.address_withdraw)return u(he("mine.enter_address")),!1;w({address:fe.address_withdraw}).then(e=>{m(e.msg),Ce(),fe.withdraw_show=!1}).catch(e=>{u(e.msg)})})())},{default:F(()=>[j(S(U(he)("mine.set")),1)]),_:1},8,["loading"]),x(t,{class:"item btn2",type:"red",onClick:s[4]||(s[4]=e=>fe.withdraw_show=!1)},{default:F(()=>[j(S(U(he)("mine.cancel")),1)]),_:1})])])]),_:1},8,["show"]),x(l,{show:fe.notice_show,"onUpdate:show":s[6]||(s[6]=e=>fe.notice_show=e),"close-on-click-overlay":!1,"close-on-popstate":!1,"lock-scroll":"",class:"notice-popup"},{default:F(()=>[C("div",ce,[C("div",de,[C("div",le,S(fe.notice.title||""),1)]),C("div",ue,S(fe.notice.note||""),1),C("div",me,[x(t,{class:"notice-ok-btn",type:"primary",onClick:Ue},{default:F(()=>[...s[8]||(s[8]=[j(" OK ",-1)])]),_:1})])])]),_:1},8,["show"]),x(c,{active:"user"})])}}},[["__scopeId","data-v-6bd42568"]]);export{pe as default};
