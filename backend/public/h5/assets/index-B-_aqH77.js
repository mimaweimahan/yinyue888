import{Z as e,$ as t,a0 as a,a1 as l,a2 as r,a3 as n,c as o,k as i,a4 as s,b as u,e as c,a5 as d,a6 as g,f,p as m,A as p,a7 as v,m as h,n as b,a8 as y,a9 as x,aa as k,ab as w,ac as S,j as C}from"./index-Sm2rxOHe.js";import{C as M,c as V}from"./index-D7DSLlth.js";import{g as I,d as B,v as A,r as E,c as z,w as $,o as T,x as j,f as P,S as L,C as W,A as q}from"./vue-vendor-C3e-Kb3Z.js";let F=0;function H(e){return Array.isArray(e)?!e.length:0!==e&&!e}function R(e,t){const{message:a}=t;return l(a)?a(e,t):a||""}function D({target:e}){e.composing=!0}function N({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function O(e){return[...e].length}function K(e,t){return[...e].slice(0,t).join("")}const[Z,G]=o("field");const J=C(B({name:Z,props:n({},V,{id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:b,max:Number,min:Number,formatter:Function,clearIcon:v("clear"),modelValue:h(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:v("focus"),formatTrigger:v("onChange"),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null},inputmode:String},{rows:b,type:v("text"),rules:Array,autosize:[Boolean,Object],labelWidth:b,labelClass:y,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}}),emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(l,{emit:n,slots:o}){const v=function(){const e=I(),{name:t="unknown"}=(null==e?void 0:e.type)||{};return`${t}-${++F}`}(),h=A({status:"unvalidated",focused:!1,validateMessage:""}),b=E(),y=E(),C=E(),{parent:V}=i(x),B=()=>{var e;return String(null!=(e=l.modelValue)?e:"")},Z=e=>d(l[e])?l[e]:V&&d(V.props[e])?V.props[e]:void 0,J=z(()=>{const e=Z("readonly");if(l.clearable&&!e){const e=""!==B(),t="always"===l.clearTrigger||"focus"===l.clearTrigger&&h.focused;return e&&t}return!1}),Q=z(()=>C.value&&o.input?C.value():l.modelValue),U=z(()=>{var e;const t=Z("required");return"auto"===t?null==(e=l.rules)?void 0:e.some(e=>e.required):t}),X=e=>e.reduce((e,t)=>e.then(()=>{if("failed"===h.status)return;let{value:e}=Q;if(t.formatter&&(e=t.formatter(e,t)),!function(e,t){if(H(e)){if(t.required)return!1;if(!1===t.validateEmpty)return!0}return!(t.pattern&&!t.pattern.test(String(e)))}(e,t))return h.status="failed",void(h.validateMessage=R(e,t));if(t.validator){if(H(e)&&!1===t.validateEmpty)return;return function(e,t){return new Promise(a=>{const l=t.validator(e,t);r(l)?l.then(a):a(l)})}(e,t).then(a=>{a&&"string"==typeof a?(h.status="failed",h.validateMessage=a):!1===a&&(h.status="failed",h.validateMessage=R(e,t))})}}),Promise.resolve()),Y=()=>{h.status="unvalidated",h.validateMessage=""},_=()=>n("endValidate",{status:h.status,message:h.validateMessage}),ee=(e=l.rules)=>new Promise(t=>{Y(),e?(n("startValidate"),X(e).then(()=>{"failed"===h.status?(t({name:l.name,message:h.validateMessage}),_()):(h.status="passed",t(),_())})):t()}),te=e=>{if(V&&l.rules){const{validateTrigger:t}=V.props,a=k(t).includes(e),r=l.rules.filter(t=>t.trigger?k(t.trigger).includes(e):a);r.length&&ee(r)}},ae=(e,t="onChange")=>{var a,r;const o=e;e=(e=>{var t;const{maxlength:a}=l;if(d(a)&&O(e)>+a){const l=B();if(l&&O(l)===+a)return l;const r=null==(t=b.value)?void 0:t.selectionEnd;if(h.focused&&r){const t=[...e],l=t.length-+a;return t.splice(r-l,l),t.join("")}return K(e,+a)}return e})(e);const i=o.length-e.length;if("number"===l.type||"digit"===l.type){const n="number"===l.type;if(e=g(e,n,n),"onBlur"===t&&""!==e&&(void 0!==l.min||void 0!==l.max)){const t=f(+e,null!=(a=l.min)?a:-1/0,null!=(r=l.max)?r:1/0);+e!==t&&(e=t.toString())}}let s=0;if(l.formatter&&t===l.formatTrigger){const{formatter:t,maxlength:a}=l;if(e=t(e),d(a)&&O(e)>+a&&(e=K(e,+a)),b.value&&h.focused){const{selectionEnd:e}=b.value,a=K(o,e);s=t(a).length-a.length}}if(b.value&&b.value.value!==e)if(h.focused){let{selectionStart:t,selectionEnd:a}=b.value;if(b.value.value=e,d(t)&&d(a)){const l=e.length;i?(t-=i,a-=i):s&&(t+=s,a+=s),b.value.setSelectionRange(Math.min(t,l),Math.min(a,l))}}else b.value.value=e;e!==l.modelValue&&n("update:modelValue",e)},le=e=>{e.target.composing||ae(e.target.value)},re=()=>{var e;return null==(e=b.value)?void 0:e.blur()},ne=()=>{var e;return null==(e=b.value)?void 0:e.focus()},oe=()=>{const r=b.value;"textarea"===l.type&&l.autosize&&r&&function(l,r){const n=e();l.style.height="auto";let o=l.scrollHeight;if(t(r)){const{maxHeight:e,minHeight:t}=r;void 0!==e&&(o=Math.min(o,e)),void 0!==t&&(o=Math.max(o,t))}o&&(l.style.height=`${o}px`,a(n))}(r,l.autosize)},ie=e=>{h.focused=!0,n("focus",e),j(oe),Z("readonly")&&re()},se=e=>{h.focused=!1,ae(B(),"onBlur"),n("blur",e),Z("readonly")||(te("onBlur"),j(oe),w())},ue=e=>n("clickInput",e),ce=e=>n("clickLeftIcon",e),de=e=>n("clickRightIcon",e),ge=z(()=>"boolean"==typeof l.error?l.error:!(!V||!V.props.showError||"failed"!==h.status)||void 0),fe=z(()=>{const e=Z("labelWidth"),t=Z("labelAlign");if(e&&"top"!==t)return{width:s(e)}}),me=e=>{if(13===e.keyCode){V&&V.props.submitOnEnter||"textarea"===l.type||m(e),"search"===l.type&&re()}n("keypress",e)},pe=()=>l.id||`${v}-input`,ve=()=>{const e=G("control",[Z("inputAlign"),{error:ge.value,custom:!!o.input,"min-height":"textarea"===l.type&&!l.autosize}]);if(o.input)return P("div",{class:e,onClick:ue},[o.input()]);const t={id:pe(),ref:b,name:l.name,rows:void 0!==l.rows?+l.rows:void 0,class:e,disabled:Z("disabled"),readonly:Z("readonly"),autofocus:l.autofocus,placeholder:l.placeholder,autocomplete:l.autocomplete,autocapitalize:l.autocapitalize,autocorrect:l.autocorrect,enterkeyhint:l.enterkeyhint,spellcheck:l.spellcheck,"aria-labelledby":l.label?`${v}-label`:void 0,"data-allow-mismatch":"attribute",onBlur:se,onFocus:ie,onInput:le,onClick:ue,onChange:N,onKeypress:me,onCompositionend:N,onCompositionstart:D};return"textarea"===l.type?P("textarea",W(t,{inputmode:l.inputmode}),null):P("input",W((a=l.type,r=l.inputmode,"number"===a&&(a="text",null!=r||(r="decimal")),"digit"===a&&(a="tel",null!=r||(r="numeric")),{type:a,inputmode:r}),t),null);var a,r},he=()=>{const e=o["right-icon"];if(l.rightIcon||e)return P("div",{class:G("right-icon"),onClick:de},[e?e():P(p,{name:l.rightIcon,classPrefix:l.iconPrefix},null)])},be=()=>{if(l.showWordLimit&&l.maxlength){const e=O(B());return P("div",{class:G("word-limit")},[P("span",{class:G("word-num")},[e]),L("/"),l.maxlength])}},ye=()=>{if(V&&!1===V.props.showErrorMessage)return;const e=l.errorMessage||h.validateMessage;if(e){const t=o["error-message"],a=Z("errorMessageAlign");return P("div",{class:G("error-message",a)},[t?t({message:e}):e])}},xe=()=>[P("div",{class:G("body")},[ve(),J.value&&P(p,{ref:y,name:l.clearIcon,class:G("clear")},null),he(),o.button&&P("div",{class:G("button")},[o.button()])]),be(),ye()];return u({blur:re,focus:ne,validate:ee,formValue:Q,resetValidation:Y,getValidationStatus:()=>h.status}),q(S,{customValue:C,resetValidation:Y,validateWithTrigger:te}),$(()=>l.modelValue,()=>{ae(B()),Y(),te("onChange"),j(oe)}),T(()=>{ae(B(),l.formatTrigger),j(oe)}),c("touchstart",e=>{m(e),n("update:modelValue",""),n("clear",e)},{target:z(()=>{var e;return null==(e=y.value)?void 0:e.$el})}),()=>{const e=Z("disabled"),t=Z("labelAlign"),a=(()=>{const e=o["left-icon"];if(l.leftIcon||e)return P("div",{class:G("left-icon"),onClick:ce},[e?e():P(p,{name:l.leftIcon,classPrefix:l.iconPrefix},null)])})();return P(M,{size:l.size,class:G({error:ge.value,disabled:e,[`label-${t}`]:t}),center:l.center,border:l.border,isLink:l.isLink,clickable:l.clickable,titleStyle:fe.value,valueClass:G("value"),titleClass:[G("label",[t,{required:U.value}]),l.labelClass],arrowDirection:l.arrowDirection},{icon:a&&"top"!==t?()=>a:null,title:()=>{const e=(()=>{const e=Z("labelWidth"),t=Z("labelAlign"),a=Z("colon")?":":"";return o.label?[o.label(),a]:l.label?P("label",{id:`${v}-label`,for:o.input?void 0:pe(),"data-allow-mismatch":"attribute",onClick:e=>{m(e),ne()},style:"top"===t&&e?{width:s(e)}:void 0},[l.label+a]):void 0})();return"top"===t?[a,e].filter(Boolean):e||[]},value:xe,extra:o.extra})}}}));export{J as F};
